---
title: 各種スイッチの違い
tags:
  - Network
  - スイッチ
  - 学習記録
private: false
updated_at: '2024-04-14T16:30:46+09:00'
id: fef3ddeb05989d03bbef
organization_url_name: null
slide: false
ignorePublish: false
---

## はじめに

L1、L2、L3、L4、L7スイッチの違いについて、まとめています

### スイッチとは

- ネットワークにおける交通誘導員のこと
- データの中身を見て、行き先を案内してくれる

L=レイヤの略で、OSI参照モデルの各レイヤに応じて、データの振り分けを行うスイッチが存在します

## 各スイッチについて

## L1スイッチ

物理層に対応するスイッチを指します

- あまり一般的ではない
- ケーブルのinput、outputを中継するためのポートが並んでいる「パッチパネル」がこれに当たる
- 大規模な環境において、例えば機器を一台増やす際などの配線の管理がしやすくなる

## L2スイッチ

データリンク層に対応するスイッチを指します

- 主な中継情報はMACアドレス
- 宛先となるMACアドレスを見て、適切なポートにフレームを転送する
- ネットワークの中継機器であるスイッチングハブがこれにあたる
  - 各ポートに接続されている端末のMACアドレスを、フレーム送信時にMACアドレステーブルに記憶し、当該の通信とは関係のないポートへ信号が流れるのを防止する
  - ただし、L2スイッチ内のMACアドレステーブルに、該当するMACアドレスが存在しない場合はブロードキャスト（一斉通信）する

:::note info
小規模拠点や一般家庭では、L2スイッチで構成されるケースがほとんどです
:::

:::note info
また、仮想スイッチとして構築される場合もあります
1台の物理サーバ上で複数の仮想マシン(VM)を動作させる際に、仮想スイッチとして構築され、各VMの仮想NICが接続されます
:::

## L3スイッチ

ネットワーク層に対応するスイッチを指します

- 主な中継情報はIPアドレス
- L2スイッチとの違いは、IPによるルーティングを行うかどうか
- 宛先となるIPアドレスを見て、適切なポートにパケットを転送する
- デフォルトルートを設定することで、L3スイッチのルーティングテーブルに書かれているIPアドレスが存在しない場合、デフォルトルートに繋がるポートへと転送する

## ルータとL3スイッチの違い

LANを超えて通信するという点は同じだが、以下の点が異なる

- ルータはLANとWANの境界に設置するのに対し、L3スイッチはLAN内に設置する
- ルータの場合はNAT/NAPTの機能を備えている
  - プライベートIPアドレスを使うLANとグローバルIPアドレスを使うWANの間でパケットのやり取りを行う必要がある為
- ルータの場合はVPNや外部からの通信を制限する機能がついていることもある

:::note info
ルータの場合はWANやインターネット接続に特化した機能がついています
:::

## L4スイッチ

トランスポート層に対応するスイッチを指します

- 主な中継情報はTCP／UDPのポート番号
- 複数サーバーへの負荷分散や、セッションの最適化を行える
- 宛先となるTCP/UDPポートを見て、適切なサーバーにパケットを転送する

## L7スイッチ

アプリケーション層に対応するスイッチを指します

- 主な中継情報はパケットの中身
- クライアントから見たときの接続先IPアドレスはLBのIPアドレスとなる
- Cookieを利用したスティッキーセッションを行うことも可能

:::note info
スティッキーセッションとは、Cookieに割り振り先を指定する事で、ロードバランサがリクエストを振り分ける際に、特定のクライアントからのリクエストを特定のサーバに紐付けることが出来る機能です
:::

- 他にも、クライアントのアクセス先のURLに応じて処理するWebサーバーを振り分ける処理が可能

## L4、L7スイッチの共通点

- ロードバランサはL4スイッチ、L7スイッチのことを指す
  - 負荷分散する際にサーバーの死活監視を行っている点が特徴

:::note info
L4スイッチの場合、特定サーバーのIPやTCPポートの組み合わせを監視し、応答が無くなると当該ポートの機能停止を判断し、一時的に負荷分散の対象から外したりします

※L7スイッチも同様に、特定URLを監視しています
:::

## （おまけ）L5、L6スイッチはないの？という話

セッション層、プレゼンテーション層に対応するL5,L6スイッチは調べた限りでは存在しませんでした

## 参考文献

[インフラエンジニアの教科書](https://www.c-r.com/book/detail/935)  
[ネットワーク超入門講座 第5版](https://www.sbcr.jp/product/4815616199/)
