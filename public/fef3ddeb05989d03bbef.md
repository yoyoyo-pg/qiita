---
title: 各種スイッチの違い
tags:
  - 学習記録
private: false
updated_at: '2024-01-11T23:51:20+09:00'
id: fef3ddeb05989d03bbef
organization_url_name: null
slide: false
ignorePublish: false
---
# はじめに

L1、L2、L3、L4、L7スイッチの違いについて、まとめています

スイッチとは

- ネットワークにおける交通誘導員のこと
- データの中身を見て、行き先を案内してくれる

L=レイヤの略で、OSI参照モデルの各レイヤに応じて、データの振り分けを行うスイッチが存在します。

## 各スイッチについて

### L1スイッチ・・・物理層に対応するスイッチ

- あまり一般的ではない
- ケーブルのinput、outputを中継するためのポートが並んでいる「パッチパネル」がこれに当たる
- 大規模な環境において、例えば機器を一台増やす際などの配線の管理がしやすくなる

### L2スイッチ・・・データリンク層に対応するスイッチ

- 主な中継情報はMACアドレス
- ネットワークの中継機器であるスイッチングハブがこれにあたる
- 宛先となるMACアドレスを見て、適切なポートにフレームを転送する
- スイッチングハブでは、各ポートに接続されている端末のMACアドレスを記憶し、当該の通信とは関係のないポートへと信号が流れるのを防止する

※ただし、ブロードキャストと呼ばれる一斉通信の場合は、通信が流れてしまいます。
例えば、L2スイッチ内に書かれているMACアドレステーブルに、該当するMACアドレスが存在しない場合等にブロードキャストされます。

※また、仮想スイッチとして構築される場合もあります。
オンプレミスでL2のデータリンク層でスイッチが必要であった複数サーバーに関しては、サーバーの仮想化により、一つの筐体の中に複数のサーバーが入り、仮想スイッチとして構築されたりします。
仮想スイッチを介する事で、それぞれの仮想サーバーの仮想NICが接続する事となります。

### L3スイッチ・・・ネットワーク層に対応するスイッチ

- 主な中継情報はIPアドレス
- L2スイッチとの違いは、IPによるルーティングを行うかどうか
- 宛先となるIPアドレスを見て、適切なポートにパケットを転送する
- L3スイッチのアドレステーブルに書かれているIPアドレスが存在しない場合、デフォルトルートに繋がるポートへと転送する

ルーターとL3スイッチはどちらもLANを超えて通信するという点においては同じだが、以下の点が異なる

- ルーターはLANとWANの境界に設置するのに対し、L3スイッチはLAN内に設置する
- ルーターの場合はNATの機能を備えている
  - プライベートIPアドレスを使うLANとグローバルIPアドレスを使うWANの間でパケットのやり取りを行う必要がある為
- ルーターの場合はVPNや外部からの通信を制限する機能がついていることもある

インターネットに接続するためにはルータもしくはL3スイッチがネットワーク回線に接続されていることが必要

### L4スイッチ・・・トランスポート層に対応するスイッチ

- 主な中継情報はTCP／UDPのポート番号
- 複数サーバーへの負荷分散や、セッションの最適化を行える
- 宛先となるTCP/UDPポートを見て、適切なサーバーにパケットを転送する

### L7スイッチ・・・アプリケーション層に対応するスイッチ

- 主な中継情報はパケットの中身
- クライアントから見たときの接続先IPアドレスはLBのIPアドレスとなる
- Cookieを利用したスティッキーセッションを行うことも可能

:::note info
スティッキーセッションとは、Cookieに割り振り先を指定する事で、ロードバランサがリクエストを振り分ける際に、特定のクライアントからのリクエストを特定のサーバに紐付けることが出来る機能です。
:::

- 他にも、クライアントのアクセス先のURLに応じて処理するWebサーバーを振り分ける処理が可能

#### L4、L7スイッチの共通点

- いわゆる、ロードバランサはL4スイッチ、L7スイッチの事を指す
  - 負荷分散する際にサーバーの死活監視を行っている点が特徴

:::note info
例えばL4スイッチの場合、特定サーバーのIPやTCPポートの組み合わせを一定間隔で監視し、応答が無くなるとポートの機能停止を判断し、一時的に負荷分散からなくしたりします。※L7スイッチも同様に、特定URLを監視しています。
:::

### （おまけ）L5,L6スイッチはないの？という話

セッション層、プレゼンテーション層に対応するL5,L6スイッチは調べた限りでは存在しませんでした。

## 参考文献

インフラエンジニアの教科書
https://www.c-r.com/book/detail/935
